<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Head/Tails breaks on the `classInt` package. • classInt</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Head/Tails breaks on the `classInt` package.">
<meta property="og:description" content="classInt">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">classInt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4-3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/headtailsR.html">Head/Tails breaks on the `classInt` package.</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-spatial/classInt/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Head/Tails breaks on the <code>classInt</code> package.</h1>
                        <h4 class="author">Diego Hernangomez</h4>
            
            <h4 class="date">2020-04-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-spatial/classInt/blob/master/vignettes/headtailsR.Rmd"><code>vignettes/headtailsR.Rmd</code></a></small>
      <div class="hidden name"><code>headtailsR.Rmd</code></div>

    </div>

    
    
<blockquote>
<em>There are far more ordinary people (say, 80 percent) than extraordinary people (say, 20 percent); this is often characterized by the 80/20 principle, based on the observation made by the Italian economist Vilfredo Pareto in 1906 that 80% of land in Italy was owned by 20% of the population. A histogram of the data values for these phenomena would reveal a right-skewed or heavy-tailed distribution. How to map the data with the heavy-tailed distribution?</em>
<div style="text-align: right">
<span class="citation">Jiang (2013)</span>
</div>
</blockquote>
<div id="abstract" class="section level1">
<h1 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h1>
<p>This vignette discusses the implementation of the “Head/tail breaks” style (<span class="citation">Jiang (2013)</span>) on the <code>classIntervals</code> function. A step-by-step example is presented in order to clarify the method. A case study using <code><a href="https://rdrr.io/pkg/spData/man/afcon.html">spData::afcon</a></code> is also included, as well as a test suite checking the performance and validation of the implementation.</p>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <strong>Head/tail breaks</strong>, sometimes referred as <strong>ht-index</strong> (<span class="citation">Jiang and Yin (2013)</span>), is a classification scheme introduced by <span class="citation">Jiang (2013)</span> in order to find groupings or hierarchy for data with a heavy-tailed distribution.</p>
<p>Heavy-tailed distributions are heavily right skewed, with a minority of large values in the head and a majority of small values in the tail. This imbalance between the head and tail, or between many small values and a few large values, can be expressed as <em>“far more small things than large things”</em>.</p>
<p>Heavy tailed distributions are commonly characterized by a power law, a lognormal or an exponential function. Nature, society, finance (<span class="citation">Vasicek (2002)</span>) and our daily lives are full of rare and extreme events, which are termed “black swan events” (<span class="citation">Taleb (2008)</span>). This line of thinking provides a good reason to reverse our thinking by focusing on low-frequency events.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">classInt</span>)

<span class="co">#1. Characterization of heavy-tail distributions----</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1234</span>)
<span class="co">#Pareto distribution a=1 b=1.161 n=1000</span>
<span class="no">sample_par</span> <span class="kw">&lt;-</span> <span class="fl">1</span> / (<span class="fl">1</span> - <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">1000</span>)) ^ (<span class="fl">1</span> / <span class="fl">1.161</span>)
<span class="no">opar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">no.readonly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">1</span>), <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">sample_par</span>, <span class="kw">decreasing</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="kw">type</span> <span class="kw">=</span> <span class="st">"l"</span>,
  <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"F(x)"</span>,
  <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">""</span>,
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"80/20 principle"</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">h</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">sample_par</span>, <span class="fl">.8</span>) ,
       <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>,
       <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red3"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">v</span> <span class="kw">=</span> <span class="fl">0.2</span>*<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">sample_par</span>) ,
       <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>,
       <span class="kw">col</span> <span class="kw">=</span> <span class="st">"darkblue"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(
  <span class="st">"topleft"</span>,
  <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"F(x): p80"</span>, <span class="st">"x: Top 20%"</span>),
  <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"red3"</span>, <span class="st">"darkblue"</span>),
  <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>,
  <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>
)

<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(
  <span class="no">sample_par</span>,
  <span class="kw">n</span> <span class="kw">=</span> <span class="fl">100</span>,
  <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">""</span>,
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Histogram"</span>,
  <span class="kw">col</span> <span class="kw">=</span> <span class="st">"grey50"</span>,
  <span class="kw">border</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">probability</span> <span class="kw">=</span> <span class="fl">TRUE</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">opar</span>)</pre></body></html></div>
<p><img src="headtailsR_files/figure-html/charheavytail-1.png" width="700"><img src="headtailsR_files/figure-html/charheavytail-2.png" width="700"></p>
</div>
<div id="breaking-method" class="section level1">
<h1 class="hasAnchor">
<a href="#breaking-method" class="anchor"></a>Breaking method</h1>
<p>The method itself consists on a four-step process performed recursively until a stopping condition is satisfied. Given a vector of values <code>var</code> the process can be described as follows:</p>
<ol style="list-style-type: decimal">
<li>Compute <code>mu = mean(var)</code>.</li>
<li>Break <code>var</code> into the <code>tail</code> (as <code>var &lt; mu</code>) and the <code>head</code> (as <code>var &gt; mu</code>).</li>
<li>Assess if the proportion of <code>head</code> over <code>var</code> is lower or equal than a given threshold (i.e. <code>length(head)/length(var) &lt;= thr</code>)</li>
<li>If 3 is <code>TRUE</code>, repeat 1 to 3 until the condition is <code>FALSE</code> or no more partitions are possible (i.e. <code>head</code> has less than two elements expressed as <code>length(head) &lt; 2</code>).</li>
</ol>
<p>It is important to note that, at the beginning of a new iteration, <code>var</code> is replaced by <code>head</code>. The underlying hypothesis is to create partitions until the head and the tail are balanced in terms of distribution.So the stopping criteria is satisfied when the last head and the last tail are evenly balanced.</p>
<p>In terms of threshold, <span class="citation">Jiang, Liu, and Jia (2013)</span> set 40% as a good approximation, meaning that if the head contains more than 40% of the observations the distribution is not considered heavy-tailed.</p>
<p>The final breaks are the vector of consecutive <code>mu</code>.</p>
</div>
<div id="step-by-step-example" class="section level1">
<h1 class="hasAnchor">
<a href="#step-by-step-example" class="anchor"></a>Step by step example</h1>
<p>We reproduce here the pseudo-code<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> as per <span class="citation">Jiang (2019)</span>:</p>
<pre><code>Recursive function Head/tail Breaks:
 Rank the input data from the largest to the smallest
 Break the data into the head and the tail around the mean;
 // the head for those above the mean
 // the tail for those below the mean
 While (head &lt;= 40%):
 Head/tail Breaks (head);
End Function</code></pre>
<p>A step-by-step example in <strong>R</strong> (for illustrative purposes) has been developed:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">
<span class="no">opar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">no.readonly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>), <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>)
<span class="no">var</span> <span class="kw">&lt;-</span> <span class="no">sample_par</span>
<span class="no">thr</span> <span class="kw">&lt;-</span> <span class="fl">.4</span>
<span class="no">brks</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">var</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">var</span>))  <span class="co">#Initialise with min and max</span>

<span class="no">sum_table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">iter</span> <span class="kw">=</span> <span class="fl">0</span>,
  <span class="kw">mu</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">prop</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">n_var</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">n_head</span> <span class="kw">=</span> <span class="fl">NA</span>
)
<span class="co">#Pars for chart</span>
<span class="no">limchart</span> <span class="kw">&lt;-</span> <span class="no">brks</span>
<span class="co">#Iteration</span>
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">10</span>) {
  <span class="no">mu</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">var</span>)
  <span class="no">brks</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">brks</span>, <span class="no">mu</span>))
  <span class="no">head</span> <span class="kw">&lt;-</span> <span class="no">var</span>[<span class="no">var</span> <span class="kw">&gt;</span> <span class="no">mu</span>]
  <span class="no">prop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">head</span>) / <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">var</span>)
  <span class="no">stopit</span> <span class="kw">&lt;-</span> <span class="no">prop</span> <span class="kw">&lt;</span> <span class="no">thr</span> <span class="kw">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">head</span>) <span class="kw">&gt;</span> <span class="fl">1</span>
  <span class="no">sum_table</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">sum_table</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">i</span>, <span class="no">mu</span>, <span class="no">prop</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">var</span>), <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">head</span>)))
  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(
    <span class="no">var</span>,
    <span class="kw">main</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Iter "</span>, <span class="no">i</span>),
    <span class="kw">breaks</span> <span class="kw">=</span> <span class="fl">50</span>,
    <span class="kw">col</span> <span class="kw">=</span> <span class="st">"grey50"</span>,
    <span class="kw">border</span> <span class="kw">=</span> <span class="fl">NA</span>,
    <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">""</span>,
    <span class="kw">xlim</span> <span class="kw">=</span> <span class="no">limchart</span>
  )
  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">v</span> <span class="kw">=</span> <span class="no">mu</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red3"</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>)
  <span class="no">ylabel</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="no">var</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="fl">50</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">FALSE</span>)$<span class="no">counts</span>)
  <span class="no">labelplot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"PropHead: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">prop</span> * <span class="fl">100</span>, <span class="fl">2</span>), <span class="st">"%"</span>)
  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(
    <span class="kw">x</span> <span class="kw">=</span> <span class="no">mu</span>,
    <span class="kw">y</span> <span class="kw">=</span> <span class="no">ylabel</span>,
    <span class="kw">labels</span> <span class="kw">=</span> <span class="no">labelplot</span>,
    <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>,
    <span class="kw">pos</span> <span class="kw">=</span> <span class="fl">4</span>
  )
  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(
    <span class="st">"right"</span>,
    <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"mu"</span>, <span class="no">i</span>),
    <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"red3"</span>),
    <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>,
    <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>
  )
  <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isFALSE</a></span>(<span class="no">stopit</span>))
    <span class="kw">break</span>
  <span class="no">var</span> <span class="kw">&lt;-</span> <span class="no">head</span>
}
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">opar</span>)</pre></body></html></div>
<p><img src="headtailsR_files/figure-html/stepbystep-1.png" width="700"><img src="headtailsR_files/figure-html/stepbystep-2.png" width="700"><img src="headtailsR_files/figure-html/stepbystep-3.png" width="700"><img src="headtailsR_files/figure-html/stepbystep-4.png" width="700"></p>
<p>As it can be seen, in each iteration the resulting head gradually loses the high-tail property, until the stopping condition is met.</p>
<table class="table">
<thead><tr class="header">
<th align="right">iter</th>
<th align="right">mu</th>
<th align="left">prop</th>
<th align="right">n_var</th>
<th align="right">n_head</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">5.6755</td>
<td align="left">14.5%</td>
<td align="right">1000</td>
<td align="right">145</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">27.2369</td>
<td align="left">21.38%</td>
<td align="right">145</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">85.1766</td>
<td align="left">19.35%</td>
<td align="right">31</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">264.7126</td>
<td align="left">50%</td>
<td align="right">6</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<p>The resulting breaks are then defined as <code>breaks = c(min(var), mu(iter=1), ..., mu(iter), max(var))</code>.</p>
</div>
<div id="implementation-on-classint-package" class="section level1">
<h1 class="hasAnchor">
<a href="#implementation-on-classint-package" class="anchor"></a>Implementation on <code>classInt</code> package</h1>
<p>The implementation in the <code>classIntervals</code> function should replicate the results:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ht_sample_par</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">sample_par</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>)
<span class="no">brks</span> <span class="kw">==</span> <span class="no">ht_sample_par</span>$<span class="no">brks</span>
<span class="co">#&gt; [1] TRUE TRUE TRUE TRUE TRUE TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">ht_sample_par</span>)
<span class="co">#&gt; style: headtails</span>
<span class="co">#&gt; [1.000295,5.675463) [5.675463,27.23693) [27.23693,85.17664) [85.17664,264.7126) </span>
<span class="co">#&gt;                 855                 114                  25                   3 </span>
<span class="co">#&gt; [264.7126,523.6254] </span>
<span class="co">#&gt;                   3</span></pre></body></html></div>
<p>As stated in <span class="citation">Jiang (2013)</span>, the number of breaks is naturally determined, however the <code>thr</code> parameter could help to adjust the final number. A lower value on <code>thr</code> would provide less breaks while a larger <code>thr</code> would increase the number, if the underlying distribution follows the <em>“far more small things than large things”</em> principle.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">opar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">no.readonly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>), <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>)

<span class="no">pal1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"wheat1"</span>, <span class="st">"wheat2"</span>, <span class="st">"red3"</span>)

<span class="co"># Minimum: single break</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">sample_par</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0</span>))
<span class="co">#&gt; style: headtails</span>
<span class="co">#&gt; [1.000295,5.675463) [5.675463,523.6254] </span>
<span class="co">#&gt;                 855                 145</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">sample_par</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0</span>),
  <span class="kw">pal</span> <span class="kw">=</span> <span class="no">pal1</span>,
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"thr = 0"</span>
)

<span class="co"># Two breaks</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">sample_par</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0.2</span>))
<span class="co">#&gt; style: headtails</span>
<span class="co">#&gt; [1.000295,5.675463) [5.675463,27.23693) [27.23693,523.6254] </span>
<span class="co">#&gt;                 855                 114                  31</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">sample_par</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0.2</span>),
  <span class="kw">pal</span> <span class="kw">=</span> <span class="no">pal1</span>,
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"thr = 0.2"</span>
)

<span class="co"># Default breaks: 0.4</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">sample_par</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>))
<span class="co">#&gt; style: headtails</span>
<span class="co">#&gt; [1.000295,5.675463) [5.675463,27.23693) [27.23693,85.17664) [85.17664,264.7126) </span>
<span class="co">#&gt;                 855                 114                  25                   3 </span>
<span class="co">#&gt; [264.7126,523.6254] </span>
<span class="co">#&gt;                   3</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">sample_par</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>),
     <span class="kw">pal</span> <span class="kw">=</span> <span class="no">pal1</span>,
     <span class="kw">main</span> <span class="kw">=</span> <span class="st">"thr = Default"</span>)

<span class="co"># Maximum breaks</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">sample_par</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">1</span>))
<span class="co">#&gt; style: headtails</span>
<span class="co">#&gt; [1.000295,5.675463) [5.675463,27.23693) [27.23693,85.17664) [85.17664,264.7126) </span>
<span class="co">#&gt;                 855                 114                  25                   3 </span>
<span class="co">#&gt;  [264.7126,391.279)  [391.279,523.6254] </span>
<span class="co">#&gt;                   2                   1</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">sample_par</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">1</span>),
  <span class="kw">pal</span> <span class="kw">=</span> <span class="no">pal1</span>,
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"thr = 1"</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">opar</span>)</pre></body></html></div>
<p><img src="headtailsR_files/figure-html/examplesimp-1.png" width="700"><img src="headtailsR_files/figure-html/examplesimp-2.png" width="700"><img src="headtailsR_files/figure-html/examplesimp-3.png" width="700"><img src="headtailsR_files/figure-html/examplesimp-4.png" width="700"></p>
<p>The method always returns at least one break, corresponding to <code><a href="https://rdrr.io/r/base/mean.html">mean(var)</a></code>.</p>
</div>
<div id="case-study" class="section level1">
<h1 class="hasAnchor">
<a href="#case-study" class="anchor"></a>Case study</h1>
<p><span class="citation">Jiang (2013)</span> states that “the new classification scheme is more natural than the natural breaks in finding the groupings or hierarchy for data with a heavy-tailed distribution.” (p. 482), referring to Jenks’ natural breaks method. In this case study we would compare “headtails” vs. “fisher”, that is the alias for the Fisher-Jenks algorithm and it is always preferred to the “jenks” style (see <code><a href="../reference/classIntervals.html">?classIntervals</a></code>). For this example we will use the <code>afcon</code> dataset from <code>spData</code> package.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">spData</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">afcon</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"spData"</span>)</pre></body></html></div>
<p>Let’s have a look to the Top 10 values and the distribution of the variable <code>totcon</code> (index of total conflict 1966-78):</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r">
<span class="co"># Top10</span>
<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">afcon</span>[<span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>, <span class="kw">decreasing</span> <span class="kw">=</span> <span class="fl">TRUE</span>),<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"name"</span>,<span class="st">"totcon"</span>)],<span class="fl">10</span>))</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="left">name</th>
<th align="right">totcon</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>EG</td>
<td align="left">EGYPT</td>
<td align="right">5246</td>
</tr>
<tr class="even">
<td>SU</td>
<td align="left">SUDAN</td>
<td align="right">4751</td>
</tr>
<tr class="odd">
<td>UG</td>
<td align="left">UGANDA</td>
<td align="right">3134</td>
</tr>
<tr class="even">
<td>CG</td>
<td align="left">ZAIRE</td>
<td align="right">3087</td>
</tr>
<tr class="odd">
<td>TZ</td>
<td align="left">TANZANIA</td>
<td align="right">2881</td>
</tr>
<tr class="even">
<td>LY</td>
<td align="left">LIBYA</td>
<td align="right">2355</td>
</tr>
<tr class="odd">
<td>KE</td>
<td align="left">KENYA</td>
<td align="right">2273</td>
</tr>
<tr class="even">
<td>SO</td>
<td align="left">SOMALIA</td>
<td align="right">2122</td>
</tr>
<tr class="odd">
<td>ET</td>
<td align="left">ETHIOPIA</td>
<td align="right">1878</td>
</tr>
<tr class="even">
<td>SF</td>
<td align="left">SOUTH AFRICA</td>
<td align="right">1875</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb8"><html><body><pre class="r">
<span class="no">opar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">no.readonly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">1</span>), <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>,
     <span class="kw">n</span> <span class="kw">=</span> <span class="fl">20</span>,
     <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Histogram"</span>,
     <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"totcon"</span>,
     <span class="kw">col</span> <span class="kw">=</span> <span class="st">"grey50"</span>,
     <span class="kw">border</span> <span class="kw">=</span> <span class="fl">NA</span>, )
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>),
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Distribution"</span>,
  <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"totcon"</span>,
)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">opar</span>)</pre></body></html></div>
<p><img src="headtailsR_files/figure-html/summspdata-1.png" width="700"><img src="headtailsR_files/figure-html/summspdata-2.png" width="700"></p>
<p>The data shows that EG and SU data present a clear hierarchy over the rest of values. As per the histogram, we can confirm a heavy-tailed distribution and therefore the <em>“far more small things than large things”</em> principle.</p>
<p>As a testing proof, on top of “headtails” and “fisher” we would use also “quantile” to have a broader view on the different breaking styles. As “quantile” is a position-based metric, it doesn’t account for the magnitude of F(x) (hierarchy), so the breaks are solely defined by the position of x on the distribution.</p>
<p>Applying the three aforementioned methods to break the data:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">brks_ht</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">brks_ht</span>)
<span class="co">#&gt; style: headtails</span>
<span class="co">#&gt;   one of 91,390 possible partitions of this variable into 5 classes</span>
<span class="co">#&gt;    [147,1350.619) [1350.619,2488.6)   [2488.6,3819.8)   [3819.8,4998.5) </span>
<span class="co">#&gt;                27                10                 3                 1 </span>
<span class="co">#&gt;     [4998.5,5246] </span>
<span class="co">#&gt;                 1</span>
<span class="co">#Same number of classes for "fisher"</span>
<span class="no">nclass</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">brks_ht</span>$<span class="no">brks</span>) - <span class="fl">1</span>
<span class="no">brks_fisher</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"fisher"</span>,
                               <span class="kw">n</span> <span class="kw">=</span> <span class="no">nclass</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">brks_fisher</span>)
<span class="co">#&gt; style: fisher</span>
<span class="co">#&gt;   one of 91,390 possible partitions of this variable into 5 classes</span>
<span class="co">#&gt;    [147,693.5) [693.5,1474.5)  [1474.5,2618)  [2618,3942.5)  [3942.5,5246] </span>
<span class="co">#&gt;             12             17              8              3              2</span>

<span class="no">brks_quantile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="st">"quantile"</span>,
                                <span class="kw">n</span> <span class="kw">=</span> <span class="no">nclass</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">brks_quantile</span>)
<span class="co">#&gt; style: quantile</span>
<span class="co">#&gt;   one of 91,390 possible partitions of this variable into 5 classes</span>
<span class="co">#&gt;       [147,604)     [604,833.6)  [833.6,1137.2) [1137.2,1877.4)   [1877.4,5246] </span>
<span class="co">#&gt;               8               9               8               8               9</span>

<span class="no">pal1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"wheat1"</span>, <span class="st">"wheat2"</span>, <span class="st">"red3"</span>)
<span class="no">opar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">no.readonly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>), <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">brks_ht</span>, <span class="kw">pal</span> <span class="kw">=</span> <span class="no">pal1</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"headtails"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">brks_fisher</span>, <span class="kw">pal</span> <span class="kw">=</span> <span class="no">pal1</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"fisher"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">brks_quantile</span>, <span class="kw">pal</span> <span class="kw">=</span> <span class="no">pal1</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"quantile"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">opar</span>)</pre></body></html></div>
<p><img src="headtailsR_files/figure-html/breaksample-1.png" width="700"><img src="headtailsR_files/figure-html/breaksample-2.png" width="700"><img src="headtailsR_files/figure-html/breaksample-3.png" width="700"></p>
<p>It is observed that the top three classes of “headtails” enclose 5 observations, whereas “fisher” includes 13 observations. In terms of classification, “headtails” breaks focuses more on extreme values.</p>
<p>The next plot compares a continuous distribution of <code>totcon</code> re-escalated to a range of <code>[1,nclass]</code> versus the distribution across breaks for each style. The continuous distribution has been offset by -0.5 in order to align the continuous and the discrete distributions.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">#Helper function to reescale values</span>
<span class="no">help_reescale</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">min</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="no">max</span> <span class="kw">=</span> <span class="fl">10</span>) {
  <span class="no">r</span> <span class="kw">&lt;-</span> (<span class="no">x</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">x</span>)) / (<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">x</span>) - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">x</span>))
  <span class="no">r</span> <span class="kw">&lt;-</span> <span class="no">r</span> * (<span class="no">max</span> - <span class="no">min</span>) + <span class="no">min</span>
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">r</span>)
}
<span class="no">afcon</span>$<span class="no">ecdf_class</span> <span class="kw">&lt;-</span> <span class="fu">help_reescale</span>(<span class="no">afcon</span>$<span class="no">totcon</span>,
                                  <span class="kw">min</span> <span class="kw">=</span> <span class="fl">1</span> - <span class="fl">0.5</span>,
                                  <span class="kw">max</span> <span class="kw">=</span> <span class="no">nclass</span> - <span class="fl">0.5</span>)
<span class="no">afcon</span>$<span class="no">ht_breaks</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>,
                        <span class="no">brks_ht</span>$<span class="no">brks</span>,
                        <span class="kw">labels</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                        <span class="kw">include.lowest</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="no">afcon</span>$<span class="no">fisher_breaks</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>,
                            <span class="no">brks_fisher</span>$<span class="no">brks</span>,
                            <span class="kw">labels</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                            <span class="kw">include.lowest</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="no">afcon</span>$<span class="no">quantile_break</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>,
                             <span class="no">brks_quantile</span>$<span class="no">brks</span>,
                             <span class="kw">labels</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                             <span class="kw">include.lowest</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="no">opar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">no.readonly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span>), <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(<span class="no">afcon</span>$<span class="no">ecdf_class</span>),
  <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.8</span>),
  <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2</span>,
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">""</span>,
  <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"class"</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(<span class="no">afcon</span>$<span class="no">ht_breaks</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"darkblue"</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(<span class="no">afcon</span>$<span class="no">fisher_breaks</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"limegreen"</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(<span class="no">afcon</span>$<span class="no">quantile_break</span>),
      <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red3"</span>,
      <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topright"</span>,
       <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Continuous"</span>, <span class="st">"headtails"</span>,
                  <span class="st">"fisher"</span>, <span class="st">"quantile"</span>),
  <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"darkblue"</span>, <span class="st">"limegreen"</span>, <span class="st">"red3"</span>),
  <span class="kw">lwd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>),
  <span class="kw">lty</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>),
  <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">opar</span>)</pre></body></html></div>
<p><img src="headtailsR_files/figure-html/benchmarkbreaks-1.png" width="672"></p>
<p>It can be observed that the distribution of “headtails” breaks is also heavy-tailed, and closer to the original distribution. On the other extreme, “quantile” provides a quasi-uniform distribution, ignoring the <code>totcon</code> hierarchy</p>
<p>In terms of data visualization, we compare here the final map using the techniques mentioned above. On this plotting exercise:</p>
<ul>
<li>
<code>cex</code> of points are always between <code>1</code> and <code>5</code>.</li>
<li>For the continuous approach, no classes are provided. This plot will be used as the reference.</li>
<li>For all the rest of styles, <code>col</code> and <code>cex</code> on each point is defined as per the class of that point.</li>
</ul>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">custompal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#FE9F6D99"</span>,
               <span class="st">"#DE496899"</span>,
               <span class="st">"#8C298199"</span>,
               <span class="st">"#3B0F7099"</span>,
               <span class="st">"#00000499"</span>)

<span class="no">afcon</span>$<span class="no">cex_points</span> <span class="kw">&lt;-</span> <span class="fu">help_reescale</span>(<span class="no">afcon</span>$<span class="no">totcon</span>,
                                  <span class="kw">min</span> <span class="kw">=</span> <span class="fl">1</span>,
                                  <span class="kw">max</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="no">opar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">no.readonly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">2</span>, <span class="fl">1.5</span>), <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>)
<span class="co"># Plot continuous</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">x</span>,
  <span class="kw">y</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">y</span>,
  <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">cex</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">cex_points</span>,
  <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">col</span> <span class="kw">=</span> <span class="st">"grey50"</span>,
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Continuous"</span>,
)

<span class="no">mcont</span> <span class="kw">&lt;-</span> (<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>) - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>)) / <span class="fl">4</span>
<span class="no">legcont</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="fl">5</span> * <span class="no">mcont</span> - (<span class="no">mcont</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">afcon</span>$<span class="no">totcon</span>))

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomleft"</span>,
       <span class="kw">xjust</span> <span class="kw">=</span> <span class="fl">1</span>,
       <span class="kw">bty</span> <span class="kw">=</span> <span class="st">"n"</span>,
       <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"   "</span>,
                  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">legcont</span>, <span class="fl">0</span>)
                  ),
       <span class="kw">col</span> <span class="kw">=</span> <span class="st">"grey50"</span>,
  <span class="kw">pt.cex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fl">5</span>),
  <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">title</span> <span class="kw">=</span> <span class="st">"totcon"</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>()

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">x</span>,
  <span class="kw">y</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">y</span>,
  <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">cex</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">ht_breaks</span>,
  <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">col</span> <span class="kw">=</span> <span class="no">custompal</span>[<span class="no">afcon</span>$<span class="no">ht_breaks</span>],
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"headtails"</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(
  <span class="st">"bottomleft"</span>,
  <span class="kw">xjust</span> <span class="kw">=</span> <span class="fl">1</span>,
  <span class="kw">bty</span> <span class="kw">=</span> <span class="st">"n"</span>,
  <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"   "</span>,
                  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">brks_ht</span>$<span class="no">brks</span>[<span class="fl">2</span>:<span class="fl">6</span>],<span class="fl">0</span>)
                  ),
  <span class="kw">col</span> <span class="kw">=</span> <span class="no">custompal</span>,
  <span class="kw">pt.cex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fl">5</span>),
  <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">title</span> <span class="kw">=</span> <span class="st">"totcon"</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>()

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">x</span>,
  <span class="kw">y</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">y</span>,
  <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">cex</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">fisher_breaks</span>,
  <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">col</span> <span class="kw">=</span> <span class="no">custompal</span>[<span class="no">afcon</span>$<span class="no">fisher_breaks</span>],
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"fisher"</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(
  <span class="st">"bottomleft"</span>,
  <span class="kw">xjust</span> <span class="kw">=</span> <span class="fl">1</span>,
  <span class="kw">bty</span> <span class="kw">=</span> <span class="st">"n"</span>,
  <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"   "</span>,
                  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">brks_fisher</span>$<span class="no">brks</span>[<span class="fl">2</span>:<span class="fl">6</span>],<span class="fl">0</span>)
                  ),
  <span class="kw">col</span> <span class="kw">=</span> <span class="no">custompal</span>,
  <span class="kw">pt.cex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fl">5</span>),
  <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">title</span> <span class="kw">=</span> <span class="st">"totcon"</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>()

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">x</span>,
  <span class="kw">y</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">y</span>,
  <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">cex</span> <span class="kw">=</span> <span class="no">afcon</span>$<span class="no">quantile_break</span>,
  <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">col</span> <span class="kw">=</span> <span class="no">custompal</span>[<span class="no">afcon</span>$<span class="no">quantile_break</span>],
  <span class="kw">main</span> <span class="kw">=</span> <span class="st">"quantile"</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(
  <span class="st">"bottomleft"</span>,
  <span class="kw">xjust</span> <span class="kw">=</span> <span class="fl">1</span>,
  <span class="kw">bty</span> <span class="kw">=</span> <span class="st">"n"</span>,
  <span class="kw">legend</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"   "</span>,
                  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">brks_quantile</span>$<span class="no">brks</span>[<span class="fl">2</span>:<span class="fl">6</span>],<span class="fl">0</span>)
                  ),
  <span class="kw">col</span> <span class="kw">=</span> <span class="no">custompal</span>,
  <span class="kw">pt.cex</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fl">5</span>),
  <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">title</span> <span class="kw">=</span> <span class="st">"totcon"</span>
)
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>()

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">opar</span>)</pre></body></html></div>
<p><img src="headtailsR_files/figure-html/finalplot%20-1.png" width="700"><img src="headtailsR_files/figure-html/finalplot%20-2.png" width="700"><img src="headtailsR_files/figure-html/finalplot%20-3.png" width="700"><img src="headtailsR_files/figure-html/finalplot%20-4.png" width="700"></p>
<p>As per the results, “headtails” seems to provide a better understanding of the most extreme values when the result is compared against the continuous plot. The “quantile” style, as expected, just provides a clustering without taking into account the real hierarchy. The “fisher” plot is in-between of these two interpretations.</p>
<p>It is also important to note that “headtails” and “fisher” reveal different information that can be useful depending of the context. While “headtails” highlights the outliers, it fails on providing a good clustering on the tail, while “fisher” seems to reflect better these patterns. This can be observed on the values of Western Africa and the Niger River Basin, where “headtails” doesn’t highlight any special cluster of conflicts, “fisher” suggests a potential cluster. This can be confirmed on the histogram generated previously, where a concentration of <code>totcon</code> around 1,000 is visible.</p>
</div>
<div id="testing-and-benchmark" class="section level1">
<h1 class="hasAnchor">
<a href="#testing-and-benchmark" class="anchor"></a>Testing and benchmark</h1>
<p>On this section the performance of the “headtails” implementation is tested, in terms of speed and handling of corner cases. A small benchmark with another styles is also presented.</p>
<p>Testing has been performed over the following distributions:</p>
<p><strong>Heavy-tailed distributions</strong></p>
<ul>
<li>Pareto</li>
<li>Exponential</li>
<li>Log-normal</li>
<li>Weibull</li>
<li>Log-Cauchy, also known as super-heavy tail distribution (<span class="citation">Falk, Huesler, and Reiss (2011)</span>, p. 80, <span class="citation">Fraga Alves, Haan, and Neves (2009)</span>)</li>
</ul>
<p><strong>Non heavy-tailed distributions</strong></p>
<ul>
<li>Normal (non heavy-tailed)</li>
<li>Truncated Normal (left-tailed)</li>
<li>Uniform distribution</li>
</ul>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co">#Init samples</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">2389</span>)

<span class="co">#Pareto distributions a=7 b=14</span>
<span class="no">paretodist</span> <span class="kw">&lt;-</span> <span class="fl">7</span> / (<span class="fl">1</span> - <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">5000000</span>)) ^ (<span class="fl">1</span> / <span class="fl">14</span>)
<span class="co">#Exponential dist</span>
<span class="no">expdist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span>(<span class="fl">5000000</span>)
<span class="co">#Lognorm</span>
<span class="no">lognormdist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">rlnorm</a></span>(<span class="fl">5000000</span>)
<span class="co">#Weibull</span>
<span class="no">weibulldist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html">rweibull</a></span>(<span class="fl">5000000</span>, <span class="fl">1</span>, <span class="kw">scale</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="co">#LogCauchy "super-heavy tail"</span>
<span class="no">logcauchdist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Cauchy.html">rcauchy</a></span>(<span class="fl">5000000</span>, <span class="fl">2</span>, <span class="fl">4</span>))
<span class="co">#Remove Inf </span>
<span class="no">logcauchdist</span> <span class="kw">&lt;-</span> <span class="no">logcauchdist</span>[<span class="no">logcauchdist</span> <span class="kw">&lt;</span> <span class="fl">Inf</span>]

<span class="co">#Normal dist</span>
<span class="no">normdist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">5000000</span>)
<span class="co">#Left-tailed distr</span>
<span class="no">leftnorm</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">normdist</span>[<span class="no">normdist</span> <span class="kw">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">normdist</span>)], <span class="fl">3</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">5000000</span>)

<span class="co">#Uniform distribution</span>
<span class="no">unifdist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">5000000</span>)</pre></body></html></div>
<p>Let’s define a helper function and proceed to run the whole test suite:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">Title</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">style</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">nsample</span>  <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">thresold</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">nbreaks</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">time_secs</span> <span class="kw">=</span> <span class="fl">NA</span>
)

<span class="no">benchmarkdist</span> <span class="kw">&lt;-</span>
  <span class="kw">function</span>(<span class="no">dist</span>,
           <span class="no">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>,
           <span class="no">thr</span> <span class="kw">=</span> <span class="fl">0.4</span>,
           <span class="no">title</span> <span class="kw">=</span> <span class="st">""</span>,
           <span class="no">plot</span> <span class="kw">=</span> <span class="fl">FALSE</span>) {
    <span class="no">init</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>()
    <span class="no">br</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/classIntervals.html">classIntervals</a></span>(<span class="no">dist</span>, <span class="kw">style</span> <span class="kw">=</span> <span class="no">style</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="no">thr</span>)
    <span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>() - <span class="no">init</span>
    <span class="no">test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
      <span class="kw">Title</span> <span class="kw">=</span> <span class="no">title</span>,
      <span class="kw">style</span>  <span class="kw">=</span> <span class="no">style</span>,
      <span class="kw">nsample</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">br</span>$<span class="no">var</span>),
                        <span class="kw">scientific</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">big.mark</span> <span class="kw">=</span> <span class="st">","</span>),
      <span class="kw">thresold</span> <span class="kw">=</span> <span class="no">thr</span>,
      <span class="kw">nbreaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">br</span>$<span class="no">brks</span>) - <span class="fl">1</span>,
      <span class="kw">time_secs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">a</span>,<span class="fl">4</span>))
    )
    <span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">testresults</span>, <span class="no">test</span>))

    <span class="kw">if</span> (<span class="no">plot</span>) {
      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(
        <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(<span class="no">br</span>$<span class="no">var</span>,
                <span class="kw">from</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">dist</span>,<span class="fl">.0005</span>),
                <span class="kw">to</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">dist</span>,<span class="fl">.9995</span>)
                ),
        <span class="kw">col</span> <span class="kw">=</span> <span class="st">"black"</span>,
        <span class="kw">cex.main</span> <span class="kw">=</span> <span class="fl">.9</span>,
        <span class="kw">main</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(
          <span class="no">title</span>,
          <span class="st">" "</span>,
          <span class="no">style</span>,
          <span class="st">", thr ="</span>,
          <span class="no">thr</span>,
          <span class="st">", nbreaks = "</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">br</span>$<span class="no">brks</span>) - <span class="fl">1</span>
        ),
        <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">""</span>,
        <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">""</span>
      )
      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">v</span> <span class="kw">=</span> <span class="no">br</span>$<span class="no">brks</span>,
             <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red3"</span>,
             <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">2</span>)
    }
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">testresults</span>)
  }
<span class="no">opar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">no.readonly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>), <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.8</span>)

<span class="co"># Pareto----</span>
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">paretodist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Pareto"</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">paretodist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Pareto"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">paretodist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Pareto"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">.75</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co">#Sample 2,000 obs</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1234</span>)
<span class="no">Paretosamp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="no">paretodist</span>, <span class="fl">2000</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">Paretosamp</span>,
                             <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Pareto sample"</span>,
                             <span class="kw">style</span> <span class="kw">=</span> <span class="st">"fisher"</span>,
                             <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">Paretosamp</span>,
                             <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Pareto sample"</span>,
                             <span class="kw">style</span> <span class="kw">=</span> <span class="st">"headtails"</span>,
                             <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)


<span class="co">#Exponential----</span>
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">expdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Exponential"</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">expdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Exponential"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">expdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Exponential"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">expdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Exponential"</span>,
                             <span class="kw">style</span> <span class="kw">=</span> <span class="st">"quantile"</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co">#Weibull-----</span>
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">weibulldist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Weibull"</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">weibulldist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Weibull"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">weibulldist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Weibull"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="co">#Logcauchy</span>
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">logcauchdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"LogCauchy"</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">logcauchdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"LogCauchy"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">logcauchdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"LogCauchy"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="co">#Normal----</span>
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">normdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Normal"</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">normdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Normal"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">normdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Normal"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co">#Truncated Left-tail Normal----</span>
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">leftnorm</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Left Normal"</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">leftnorm</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Left Normal"</span>, <span class="kw">thr</span> <span class="kw">=</span> -<span class="fl">100</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">leftnorm</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Left Normal"</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">500</span>)

<span class="co">#Uniform----</span>
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">unifdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Uniform"</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0.7</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">unifdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Uniform"</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="no">testresults</span> <span class="kw">&lt;-</span> <span class="fu">benchmarkdist</span>(<span class="no">unifdist</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Uniform"</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">thr</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="no">opar</span>)

<span class="co"># Results</span>
<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="no">testresults</span>[-<span class="fl">1</span>, ], <span class="kw">row.names</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">Title</th>
<th align="left">style</th>
<th align="left">nsample</th>
<th align="right">thresold</th>
<th align="right">nbreaks</th>
<th align="left">time_secs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Pareto</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.40</td>
<td align="right">15</td>
<td align="left">0.5926</td>
</tr>
<tr class="even">
<td align="left">Pareto</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.00</td>
<td align="right">2</td>
<td align="left">0.5117</td>
</tr>
<tr class="odd">
<td align="left">Pareto</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.75</td>
<td align="right">15</td>
<td align="left">0.477</td>
</tr>
<tr class="even">
<td align="left">Pareto sample</td>
<td align="left">fisher</td>
<td align="left">2,000</td>
<td align="right">0.40</td>
<td align="right">12</td>
<td align="left">0.0234</td>
</tr>
<tr class="odd">
<td align="left">Pareto sample</td>
<td align="left">headtails</td>
<td align="left">2,000</td>
<td align="right">0.40</td>
<td align="right">8</td>
<td align="left">3e-04</td>
</tr>
<tr class="even">
<td align="left">Exponential</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.40</td>
<td align="right">16</td>
<td align="left">0.4325</td>
</tr>
<tr class="odd">
<td align="left">Exponential</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.00</td>
<td align="right">2</td>
<td align="left">0.4672</td>
</tr>
<tr class="even">
<td align="left">Exponential</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">1.00</td>
<td align="right">17</td>
<td align="left">0.5037</td>
</tr>
<tr class="odd">
<td align="left">Exponential</td>
<td align="left">quantile</td>
<td align="left">5,000,000</td>
<td align="right">0.40</td>
<td align="right">24</td>
<td align="left">0.8129</td>
</tr>
<tr class="even">
<td align="left">Weibull</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.40</td>
<td align="right">16</td>
<td align="left">0.4561</td>
</tr>
<tr class="odd">
<td align="left">Weibull</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.00</td>
<td align="right">2</td>
<td align="left">0.3942</td>
</tr>
<tr class="even">
<td align="left">Weibull</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">1.00</td>
<td align="right">17</td>
<td align="left">0.5268</td>
</tr>
<tr class="odd">
<td align="left">LogCauchy</td>
<td align="left">headtails</td>
<td align="left">4,991,187</td>
<td align="right">0.40</td>
<td align="right">6</td>
<td align="left">0.4355</td>
</tr>
<tr class="even">
<td align="left">LogCauchy</td>
<td align="left">headtails</td>
<td align="left">4,991,187</td>
<td align="right">0.00</td>
<td align="right">2</td>
<td align="left">0.4336</td>
</tr>
<tr class="odd">
<td align="left">LogCauchy</td>
<td align="left">headtails</td>
<td align="left">4,991,187</td>
<td align="right">1.00</td>
<td align="right">6</td>
<td align="left">0.4299</td>
</tr>
<tr class="even">
<td align="left">Normal</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.40</td>
<td align="right">2</td>
<td align="left">0.4539</td>
</tr>
<tr class="odd">
<td align="left">Normal</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.00</td>
<td align="right">2</td>
<td align="left">0.4123</td>
</tr>
<tr class="even">
<td align="left">Normal</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">1.00</td>
<td align="right">17</td>
<td align="left">0.4908</td>
</tr>
<tr class="odd">
<td align="left">Left Normal</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.40</td>
<td align="right">2</td>
<td align="left">0.6142</td>
</tr>
<tr class="even">
<td align="left">Left Normal</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">-100.00</td>
<td align="right">2</td>
<td align="left">0.5393</td>
</tr>
<tr class="odd">
<td align="left">Left Normal</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">500.00</td>
<td align="right">21</td>
<td align="left">0.6402</td>
</tr>
<tr class="even">
<td align="left">Uniform</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.70</td>
<td align="right">22</td>
<td align="left">0.4753</td>
</tr>
<tr class="odd">
<td align="left">Uniform</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">0.00</td>
<td align="right">2</td>
<td align="left">0.488</td>
</tr>
<tr class="even">
<td align="left">Uniform</td>
<td align="left">headtails</td>
<td align="left">5,000,000</td>
<td align="right">1.00</td>
<td align="right">22</td>
<td align="left">0.5122</td>
</tr>
</tbody>
</table>
<p><img src="headtailsR_files/figure-html/testresults-1.png" width="700"><img src="headtailsR_files/figure-html/testresults-2.png" width="700"><img src="headtailsR_files/figure-html/testresults-3.png" width="700"><img src="headtailsR_files/figure-html/testresults-4.png" width="700"><img src="headtailsR_files/figure-html/testresults-5.png" width="700"><img src="headtailsR_files/figure-html/testresults-6.png" width="700"><img src="headtailsR_files/figure-html/testresults-7.png" width="700"><img src="headtailsR_files/figure-html/testresults-8.png" width="700"><img src="headtailsR_files/figure-html/testresults-9.png" width="700"><img src="headtailsR_files/figure-html/testresults-10.png" width="700"><img src="headtailsR_files/figure-html/testresults-11.png" width="700"><img src="headtailsR_files/figure-html/testresults-12.png" width="700"><img src="headtailsR_files/figure-html/testresults-13.png" width="700"><img src="headtailsR_files/figure-html/testresults-14.png" width="700"></p>
<p>The implementation works as expected, with a good performance given the size of the sample, and also compares well with another current implementations on <code>classIntervals</code>.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Falk_2011">
<p>Falk, Michael, Juerg Huesler, and Rolf-Dieter Reiss. 2011. <em>Laws of Small Numbers: Extremes and Rare Events</em>. <em>Laws of Small Numbers: Extremes and Rare Events</em>. <a href="https://doi.org/10.1007/978-3-0348-0009-9">https://doi.org/10.1007/978-3-0348-0009-9</a>.</p>
</div>
<div id="ref-Fraga_2009">
<p>Fraga Alves, Maria, L.D. Haan, and Claudia Neves. 2009. “Statistical Inference for Heavy and Super-Heavy Tailed Distributions.” <em>J. Stat. Plan. Inf.</em> 139 (January): 213–27.</p>
</div>
<div id="ref-Jiang_2013">
<p>Jiang, Bin. 2013. “Head/Tail Breaks: A New Classification Scheme for Data with a Heavy-Tailed Distribution.” <em>The Professional Geographer</em> 65 (3): 482–94. <a href="https://doi.org/10.1080/00330124.2012.700499">https://doi.org/10.1080/00330124.2012.700499</a>.</p>
</div>
<div id="ref-Jiang_2019">
<p>———. 2019. “A Recursive Definition of Goodness of Space for Bridging the Concepts of Space and Place for Sustainability.” <em>Sustainability</em> 11 (15): 4091. <a href="https://doi.org/10.3390/su11154091">https://doi.org/10.3390/su11154091</a>.</p>
</div>
<div id="ref-Jiang3_2013">
<p>Jiang, Bin, Xintao Liu, and Tao Jia. 2013. “Scaling of Geographic Space as a Universal Rule for Map Generalization.” <em>Annals of the Association of American Geographers</em> 103 (4): 844–55. <a href="https://doi.org/10.1080/00045608.2013.765773">https://doi.org/10.1080/00045608.2013.765773</a>.</p>
</div>
<div id="ref-Jiang2_2013">
<p>Jiang, Bin, and Junjun Yin. 2013. “Ht-Index for Quantifying the Fractal or Scaling Structure of Geographic Features.” <em>Annals of the Association of American Geographers</em> 104 (3): 530–40. <a href="https://doi.org/10.1080/00045608.2013.834239">https://doi.org/10.1080/00045608.2013.834239</a>.</p>
</div>
<div id="ref-taleb_black_2008">
<p>Taleb, Nassim Nicholas. 2008. <em>The Black Swan: The Impact of the Highly Improbable</em>. 1st ed. London: Random House.</p>
</div>
<div id="ref-vasicek2012">
<p>Vasicek, Oldrich. 2002. “Loan Portfolio Value.” <em>Risk</em>, December, 160–62.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>The method implemented on <code>classInt</code> corresponds to head/tails 1.0 as named on this article.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
